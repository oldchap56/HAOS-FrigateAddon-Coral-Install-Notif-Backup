# HAOS-Frigate-addon-Install-Notif-Backup
## WARNING
### This tutorial is in "To be validated" version and may not be usable as is! I will make a version 1 "validated" as soon as possible.

## Introduction
There is extensive documentation available for installing Frigate in a Container LSX, but I have not found one for installing a Frigate add-on suite, with Backup and notification on smartphones.

Having struggled and exchanged on these subjects, I think it is interesting to share what works for me with others. This is also a Version 0 of the documentation because there are many points to improve. I will incorporate them as I modify my configuration.

## Prerequisites
### It is assumed that you have already:
- installed Proxmox
- installed HAOS
- installed the following add-ons: HACS, Mosquitto browser, Alarmo (optional)
- set up your external access: for my part with the DuckDNS and NGINX add-ons
- tested your cameras with the rtsp or onvif protocol (or other, but I haven't tested)
- configured a Telegram bot in HAOS.

### Tutorial flow:
- Connection of Coral to the HAOS VM
- Installation of Frigate add-on
- Configuration of Frigate
- Integration of Frigate (yes, it's different, I had a hard time understanding that)
- Download of the "rclone backup" add-on which will be used to export photos and videos of people to Google Drive
- Configuration of the "rclone backup" add-on
- Creation of an Automation to restart the "Rclone backup" add-on whenever an event (detection) is generated by Frigate, to have recordings backed up in Google Drive fairly quickly (15 seconds) after the intrusion
- Configuration of notifications using SgtBatten's blueprint
- Creation of an Automation to send photos and texts via Telegram_bot
- Addition in Alarmo (or direct construction by Automation) of 2 actions related to alarms:
  - activation of camera detections if Alarm armed (also used for testing when needed)
  - deactivation of camera detections if Alarm disarmed (also used for testing when needed)

## 1. Connection of Coral to the HAOS VM
### Initial Proposal
There are multiple tutorials on "How to access Coral from Frigate", all based on integration from the USB port number.
Here I show you a method that is usually not used, because I preferred to do an integration from the name or ID of the Coral component, especially since I am not a Linux pro so I had difficulty identifying the USB port, integrating it through the Proxmox interface, etc.
I only put one photo because I think you must have already integrated USB dongles into your Home Assistant OS

So, after plugging in your CORAL Key - with a USB cable and not directly into your computer (for me a NUC), you need to:
- go to the Proxmox interface,
- click on your HAOS VM
- go to the "Hardware" line
- click at the top on "Add", then "Add USB device"
- choose from the drop-down menu "Use USB device and manufacturer IDs"
- finally choose the device corresponding to Coral.

### WARNING: this manipulation will have to be done twice because the Coral device changes names.
- the first time for me it was seen as GOOGLE manufacturer with an id
- after a few Frigate tests it had disappeared from the config and so it had to be reinstalled, this time it does not have a manufacturer's name, it must be identified with its id (which has also changed)
- after this second integration it is stable for me and recognized in Frigate (we will see later how to be sure).

### More classical proposal (found on various tutorials)
It is about integrating Coral from the USB port number .... successful manipulation for me by "breaking" the method above.
First, you need to identify the different USB dongles present on your "HA server" (for me a NUC).
For that in Proxmox:
- go back to the level of the node on which your HAOS VM is located,
- select the shell of this node (for me I called it Proxmox)
- launch the command lsusb, which will give you the different ports used

![Coral 1 lsusb](https://github.com/oldchap56/HAOS-FrigateAddon-Coral-Install-Notif-Backup/assets/153823477/f2a430a9-2583-43cb-a7e8-454c44d914fb)
- then go to the HAOS VM interface (for me VM 102 - Prod VM), and integrate Coral as above but this time by choosing "use USB port", which gives in detail:
  - go to the Proxmox interface,
  - click on your HAOS VM
  - go to the "Hardware" line
  - click at the top on "Add", then "Add USB device"
  - choose from the drop-down menu "Use USB port"
  - finally choose the device corresponding to Coral, by clicking on the correct line 'for me I chose line 2.6 while lsusb gave me usb 2 port 5 !!! I went there by deduction having identified all the other dongles/USB ports)
  ![Coral 2 HAOS VM vision](https://github.com/oldchap56/HAOS-FrigateAddon-Coral-Install-Notif-Backup/assets/153823477/b69e1a73-04cc-4dae-a8ef-49241d6e687e)

### !!! In both installation cases you can move on to the installation of Frigate, in the next ยง.

## 2. Installation of Frigate add-on

- In your Home Assistant, go to Settings, Add-ons, Add-on Store, then click on the top right to add a new add-on repository and add this link https://github.com/blakeblackshear/frigate to the list.
- Restart Home Assistant
- Go to Settings, Add-ons, Add-on Store (bottom for me), search for Frigate and click on Frigate, follow the instructions by indicating that you are running it on HAOS.

- Go back to Settings, Add-ons, and check "Show in sidebar"
  
 ![Frigate Add-on](https://github.com/oldchap56/HAOS-FrigateAddon-Coral-Install-Notif-Backup/assets/153823477/1ea7e5a3-8082-4348-9e0e-3d1826be2c57)

From this moment on, you will be able to configure Frigate.

